import React, { useState, useEffect } from 'react';
import { Camera, Mic, Send, Phone, Video, MoreVertical, Circle } from 'lucide-react';

interface Message {
  id: number;
  text: string;
  sender: 'user' | 'bot';
  timestamp: string;
  options?: string[];
}

interface FunnelStep {
  message: string;
  options?: string[];
  delay: number;
}

const FUNNEL_STEPS: FunnelStep[] = [
  {
    message: `ğŸ”¥ Seja bem-vindo! ğŸ”¥\nVocÃª assistiu ao vÃ­deo e sabe que algo nÃ£o estÃ¡ certo com sua virilidade.\nE eu sei o quanto isso afeta sua autoestima, sua vida sexual e atÃ© seu relacionamento.\nPor isso, antes de qualquer coisa, preciso entender mais sobre o que estÃ¡ acontecendo com vocÃª.\nğŸ“Œ Me diz aqui qual dessas situaÃ§Ãµes mais descreve o que vocÃª estÃ¡ enfrentando:`,
    options: [
      'Tenho ereÃ§Ãµes fracas e murcham rÃ¡pido',
      'Minha vontade de transar diminuiu muito',
      'JÃ¡ falhei na cama e isso me abalou muito',
      'Consigo ficar duro, mas gozo rÃ¡pido demais'
    ],
    delay: 1000
  },
  {
    message: `Entendiâ€¦ vocÃª nÃ£o estÃ¡ sozinho.\nğŸ“Œ Mais de 8 em cada 10 homens enfrentam esse problema em algum momento da vida.\nMas sabe qual o maior erro?\nğŸ”´ A maioria acha que Ã© normal, que vai passar sozinho ou que isso sÃ³ acontece por cansaÃ§o e estresse.\nğŸš¨ E Ã© aÃ­ que mora o perigo!\nEsse problema nÃ£o sÃ³ NÃƒO vai embora sozinho, como pode PIORAR atÃ© chegar num ponto sem voltaâ€¦\nSe hoje vocÃª jÃ¡ percebe sua virilidade caindo, imagine como estarÃ¡ daqui a 3 mesesâ€¦ 6 mesesâ€¦ ou 1 anoâ€¦\nğŸ“Œ Mas calma! Porque agora eu vou te ajudar a REVERTER ISSO!`,
    delay: 3000
  },
  {
    message: `Agora, preciso ajustar o Truque da Madeira Firmeâ„¢ para o seu caso.\nğŸ“Œ Qual sua idade?`,
    options: [
      'Menos de 30 anos',
      'Entre 31 e 45 anos',
      'Entre 46 e 59 anos',
      'Mais de 60 anos'
    ],
    delay: 2000
  },
  {
    message: `ğŸ“Œ Qual o seu peso aproximado?`,
    options: [
      'AtÃ© 70 kg',
      'Entre 71 e 85 kg',
      'Entre 86 e 100 kg',
      'Mais de 100 kg'
    ],
    delay: 1500
  },
  {
    message: `ğŸ“Œ HÃ¡ quanto tempo vocÃª percebe essa perda de desempenho?`,
    options: [
      'Menos de 3 meses',
      'Entre 3 e 12 meses',
      'Mais de 1 ano',
      'Minha vida toda'
    ],
    delay: 1500
  },
  {
    message: `Ã“timo, agora eu jÃ¡ consigo te dizer exatamente o que estÃ¡ acontecendo com seu corpo!\nğŸš¨ E acredite: VOCÃŠ NÃƒO TEM CULPA DE ESTAR PASSANDO POR ISSO!\nO problema nÃ£o Ã© sua idade, seu estilo de vida ou sua genÃ©ticaâ€¦\nO verdadeiro culpado Ã© um bloqueio oculto que estÃ¡ impedindo seu corpo de mandar sangue para o seu pÃªnis.\nE se o sangue nÃ£o chega lÃ¡ com forÃ§a totalâ€¦\nğŸ“Œ Sua ereÃ§Ã£o perde potÃªncia\nğŸ“Œ VocÃª ejacula rÃ¡pido demais\nğŸ“Œ Seu desejo sexual desaparece\nMAS A BOA NOTÃCIA Ã‰ QUEâ€¦\nğŸ’¥ Eu jÃ¡ tenho a soluÃ§Ã£o para o seu caso! ğŸ’¥\nAgora eu vou preparar sua receita personalizada com o Truque da Madeira Firmeâ„¢.`,
    delay: 2000
  },
  {
    message: `ğŸ“Œ Baseado no seu caso, a sua fÃ³rmula estÃ¡ pronta!\nAqui estÃ¡ o que vocÃª vai receber:\nâœ… A Receita Personalizada do TRUQUE DA MADEIRA FIRME â€“ com os ingredientes exatos para o seu caso.\nâœ… O Passo a Passo Simples e RÃ¡pido â€“ para garantir que vocÃª faÃ§a do jeito certo e tenha os melhores resultados.\nâœ… O Momento Certo Para Tomar â€“ para maximizar a potÃªncia e manter sua ereÃ§Ã£o firme por mais tempo.\nâœ… Lista de Alimentos que Turbinam sua Testosterona â€“ e fazem sua virilidade disparar naturalmente.\n\nğŸ“Œ Veja o que quem jÃ¡ usou estÃ¡ dizendo:\n\nğŸ—£ï¸ Lucas S. â€“ 41 anos\n"Depois de 2 semanas aplicando o truque, minha ereÃ§Ã£o voltou a ser como na adolescÃªncia! Minha esposa achou que eu tinha tomado algo, mas era sÃ³ o mÃ©todo que realmente funciona!"\n\nğŸ—£ï¸ Ricardo M. â€“ 52 anos\n"Depois de 5 meses falhando com minha mulher, achei que tinha perdido minha virilidade. Fiz o ritual e no primeiro dia jÃ¡ senti a diferenÃ§a. Agora, estou melhor do que nunca!"`,
    delay: 2000
  },
  {
    message: `Agora, deixa eu te contar uma coisaâ€¦\nâš ï¸ Essa consulta que eu fiz com vocÃª foi 100% GRATUITA.\nInicialmente, eu tambÃ©m ia liberar a receita personalizada sem custoâ€¦\nMAS ACONTECEU UM PROBLEMA!\nMuitos homens pegavam a receita e NÃƒO FAZIAM o mÃ©todo direito, simplesmente porque nÃ£o davam valor.\nEntÃ£o, para garantir que apenas os homens realmente comprometidos recebam essa fÃ³rmula poderosa, eu precisei adicionar uma pequena taxa de ativaÃ§Ã£o.\nğŸ“Œ O valor original dessa receita Ã© R$97â€¦\nğŸ”¥ HOJE, estou liberando para vocÃª por apenas R$27!\nOu seja, menos que um lanche ou uma cerveja no bar!\nğŸ“Œ Mas atenÃ§Ã£o! Isso sÃ³ vale para quem ativar AGORA!`,
    delay: 2000
  },
  {
    message: `AGORA, VOCÃŠ TEM DUAS ESCOLHAS:\nâŒ Ignorar essa oportunidade e continuar sofrendo com ereÃ§Ãµes fracas e falhasâ€¦\nâœ… Ou garantir sua receita AGORA e recuperar sua potÃªncia mÃ¡xima enquanto ainda hÃ¡ tempo!\nğŸ“Œ MAS ATENÃ‡ÃƒO!\nğŸ”¥ Como esse atendimento Ã© individual, eu sÃ³ consigo liberar algumas poucas receitas por dia.\nE agora, restam apenas 3 vagas disponÃ­veis!\nSe vocÃª sair agora e tentar voltar depois, pode ser que sua vaga jÃ¡ tenha sido preenchida.\nğŸš€ Clique no botÃ£o abaixo AGORA e ative sua Receita Personalizada do Truque da Madeira Firmeâ„¢!`,
    options: ['SIM! Quero minha Receita Personalizada AGORA!'],
    delay: 2000
  }
];

function App() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [currentStep, setCurrentStep] = useState(0);
  const [isTyping, setIsTyping] = useState(false);
  const [waitingForResponse, setWaitingForResponse] = useState(false);

  const addMessage = (text: string, sender: 'user' | 'bot', options?: string[]) => {
    setMessages(prev => [...prev, {
      id: Date.now(),
      text,
      sender,
      timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
      options
    }]);
  };

  const handleNextStep = async () => {
    if (currentStep < FUNNEL_STEPS.length && !waitingForResponse) {
      setIsTyping(true);
      setWaitingForResponse(true);
      await new Promise(resolve => setTimeout(resolve, FUNNEL_STEPS[currentStep].delay));
      setIsTyping(false);
      addMessage(FUNNEL_STEPS[currentStep].message, 'bot', FUNNEL_STEPS[currentStep].options);
      
      // Only automatically proceed to next step if there are no options to select
      if (!FUNNEL_STEPS[currentStep].options) {
        setWaitingForResponse(false);
        setCurrentStep(prev => prev + 1);
        // Add delay before next message if there are no options
        setTimeout(() => {
          handleNextStep();
        }, 2000);
      }
    }
  };

  const handleOptionClick = async (option: string) => {
    addMessage(option, 'user');
    setWaitingForResponse(false);
    setCurrentStep(prev => prev + 1);
    setTimeout(() => {
      handleNextStep();
    }, 1000);
  };

  useEffect(() => {
    if (currentStep === 0) {
      handleNextStep();
    }
  }, []);

  return (
    <div className="h-screen flex flex-col bg-gray-100">
      {/* Header with banner and profile */}
      <div className="bg-emerald-600 text-white">
        <div className="p-4">
          <div className="flex items-center gap-4">
            <div className="relative">
              <img
                src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=150&h=150&fit=crop"
                alt="Specialist profile"
                className="w-12 h-12 rounded-full object-cover"
              />
              <div className="absolute bottom-0 right-0 flex items-center">
                <Circle className="w-3 h-3 fill-green-400 text-green-400 animate-pulse" />
                <span className="text-xs ml-1">Online</span>
              </div>
            </div>
            <div>
              <h1 className="font-semibold text-lg">Especialista em SaÃºde Masculina</h1>
              <p className="text-sm opacity-90">Atendimento Personalizado</p>
            </div>
          </div>
        </div>
        <div className="h-20 bg-emerald-700 relative overflow-hidden">
          <img
            src="https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=1200&h=200&fit=crop"
            alt="Health banner"
            className="w-full h-full object-cover opacity-50"
          />
        </div>
      </div>

      {/* Chat messages area */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((message) => (
          <div
            key={message.id}
            className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[80%] rounded-lg p-3 ${
                message.sender === 'user'
                  ? 'bg-emerald-500 text-white'
                  : 'bg-white text-gray-800'
              }`}
            >
              <p className="whitespace-pre-line">{message.text}</p>
              {message.options && (
                <div className="mt-4 space-y-2">
                  {message.options.map((option, index) => (
                    <button
                      key={index}
                      onClick={() => handleOptionClick(option)}
                      className="w-full p-2 text-left bg-emerald-100 hover:bg-emerald-200 text-emerald-800 rounded transition-colors"
                    >
                      {option}
                    </button>
                  ))}
                </div>
              )}
              <p className="text-xs mt-1 opacity-80">{message.timestamp}</p>
            </div>
          </div>
        ))}
        {isTyping && (
          <div className="flex justify-start">
            <div className="bg-gray-200 rounded-lg px-4 py-2">
              <div className="flex space-x-2">
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default App;
