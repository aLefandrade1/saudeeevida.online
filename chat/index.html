import React, { useState, useEffect } from 'react';
import { Camera, Mic, Send, Phone, Video, MoreVertical, Circle } from 'lucide-react';

interface Message {
  id: number;
  text: string;
  sender: 'user' | 'bot';
  timestamp: string;
  options?: string[];
}

interface FunnelStep {
  message: string;
  options?: string[];
  delay: number;
}

const FUNNEL_STEPS: FunnelStep[] = [
  {
    message: `🔥 Seja bem-vindo! 🔥\nVocê assistiu ao vídeo e sabe que algo não está certo com sua virilidade.\nE eu sei o quanto isso afeta sua autoestima, sua vida sexual e até seu relacionamento.\nPor isso, antes de qualquer coisa, preciso entender mais sobre o que está acontecendo com você.\n📌 Me diz aqui qual dessas situações mais descreve o que você está enfrentando:`,
    options: [
      'Tenho ereções fracas e murcham rápido',
      'Minha vontade de transar diminuiu muito',
      'Já falhei na cama e isso me abalou muito',
      'Consigo ficar duro, mas gozo rápido demais'
    ],
    delay: 1000
  },
  {
    message: `Entendi… você não está sozinho.\n📌 Mais de 8 em cada 10 homens enfrentam esse problema em algum momento da vida.\nMas sabe qual o maior erro?\n🔴 A maioria acha que é normal, que vai passar sozinho ou que isso só acontece por cansaço e estresse.\n🚨 E é aí que mora o perigo!\nEsse problema não só NÃO vai embora sozinho, como pode PIORAR até chegar num ponto sem volta…\nSe hoje você já percebe sua virilidade caindo, imagine como estará daqui a 3 meses… 6 meses… ou 1 ano…\n📌 Mas calma! Porque agora eu vou te ajudar a REVERTER ISSO!`,
    delay: 3000
  },
  {
    message: `Agora, preciso ajustar o Truque da Madeira Firme™ para o seu caso.\n📌 Qual sua idade?`,
    options: [
      'Menos de 30 anos',
      'Entre 31 e 45 anos',
      'Entre 46 e 59 anos',
      'Mais de 60 anos'
    ],
    delay: 2000
  },
  {
    message: `📌 Qual o seu peso aproximado?`,
    options: [
      'Até 70 kg',
      'Entre 71 e 85 kg',
      'Entre 86 e 100 kg',
      'Mais de 100 kg'
    ],
    delay: 1500
  },
  {
    message: `📌 Há quanto tempo você percebe essa perda de desempenho?`,
    options: [
      'Menos de 3 meses',
      'Entre 3 e 12 meses',
      'Mais de 1 ano',
      'Minha vida toda'
    ],
    delay: 1500
  },
  {
    message: `Ótimo, agora eu já consigo te dizer exatamente o que está acontecendo com seu corpo!\n🚨 E acredite: VOCÊ NÃO TEM CULPA DE ESTAR PASSANDO POR ISSO!\nO problema não é sua idade, seu estilo de vida ou sua genética…\nO verdadeiro culpado é um bloqueio oculto que está impedindo seu corpo de mandar sangue para o seu pênis.\nE se o sangue não chega lá com força total…\n📌 Sua ereção perde potência\n📌 Você ejacula rápido demais\n📌 Seu desejo sexual desaparece\nMAS A BOA NOTÍCIA É QUE…\n💥 Eu já tenho a solução para o seu caso! 💥\nAgora eu vou preparar sua receita personalizada com o Truque da Madeira Firme™.`,
    delay: 2000
  },
  {
    message: `📌 Baseado no seu caso, a sua fórmula está pronta!\nAqui está o que você vai receber:\n✅ A Receita Personalizada do TRUQUE DA MADEIRA FIRME – com os ingredientes exatos para o seu caso.\n✅ O Passo a Passo Simples e Rápido – para garantir que você faça do jeito certo e tenha os melhores resultados.\n✅ O Momento Certo Para Tomar – para maximizar a potência e manter sua ereção firme por mais tempo.\n✅ Lista de Alimentos que Turbinam sua Testosterona – e fazem sua virilidade disparar naturalmente.\n\n📌 Veja o que quem já usou está dizendo:\n\n🗣️ Lucas S. – 41 anos\n"Depois de 2 semanas aplicando o truque, minha ereção voltou a ser como na adolescência! Minha esposa achou que eu tinha tomado algo, mas era só o método que realmente funciona!"\n\n🗣️ Ricardo M. – 52 anos\n"Depois de 5 meses falhando com minha mulher, achei que tinha perdido minha virilidade. Fiz o ritual e no primeiro dia já senti a diferença. Agora, estou melhor do que nunca!"`,
    delay: 2000
  },
  {
    message: `Agora, deixa eu te contar uma coisa…\n⚠️ Essa consulta que eu fiz com você foi 100% GRATUITA.\nInicialmente, eu também ia liberar a receita personalizada sem custo…\nMAS ACONTECEU UM PROBLEMA!\nMuitos homens pegavam a receita e NÃO FAZIAM o método direito, simplesmente porque não davam valor.\nEntão, para garantir que apenas os homens realmente comprometidos recebam essa fórmula poderosa, eu precisei adicionar uma pequena taxa de ativação.\n📌 O valor original dessa receita é R$97…\n🔥 HOJE, estou liberando para você por apenas R$27!\nOu seja, menos que um lanche ou uma cerveja no bar!\n📌 Mas atenção! Isso só vale para quem ativar AGORA!`,
    delay: 2000
  },
  {
    message: `AGORA, VOCÊ TEM DUAS ESCOLHAS:\n❌ Ignorar essa oportunidade e continuar sofrendo com ereções fracas e falhas…\n✅ Ou garantir sua receita AGORA e recuperar sua potência máxima enquanto ainda há tempo!\n📌 MAS ATENÇÃO!\n🔥 Como esse atendimento é individual, eu só consigo liberar algumas poucas receitas por dia.\nE agora, restam apenas 3 vagas disponíveis!\nSe você sair agora e tentar voltar depois, pode ser que sua vaga já tenha sido preenchida.\n🚀 Clique no botão abaixo AGORA e ative sua Receita Personalizada do Truque da Madeira Firme™!`,
    options: ['SIM! Quero minha Receita Personalizada AGORA!'],
    delay: 2000
  }
];

function App() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [currentStep, setCurrentStep] = useState(0);
  const [isTyping, setIsTyping] = useState(false);
  const [waitingForResponse, setWaitingForResponse] = useState(false);

  const addMessage = (text: string, sender: 'user' | 'bot', options?: string[]) => {
    setMessages(prev => [...prev, {
      id: Date.now(),
      text,
      sender,
      timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
      options
    }]);
  };

  const handleNextStep = async () => {
    if (currentStep < FUNNEL_STEPS.length && !waitingForResponse) {
      setIsTyping(true);
      setWaitingForResponse(true);
      await new Promise(resolve => setTimeout(resolve, FUNNEL_STEPS[currentStep].delay));
      setIsTyping(false);
      addMessage(FUNNEL_STEPS[currentStep].message, 'bot', FUNNEL_STEPS[currentStep].options);
      
      // Only automatically proceed to next step if there are no options to select
      if (!FUNNEL_STEPS[currentStep].options) {
        setWaitingForResponse(false);
        setCurrentStep(prev => prev + 1);
        // Add delay before next message if there are no options
        setTimeout(() => {
          handleNextStep();
        }, 2000);
      }
    }
  };

  const handleOptionClick = async (option: string) => {
    addMessage(option, 'user');
    setWaitingForResponse(false);
    setCurrentStep(prev => prev + 1);
    setTimeout(() => {
      handleNextStep();
    }, 1000);
  };

  useEffect(() => {
    if (currentStep === 0) {
      handleNextStep();
    }
  }, []);

  return (
    <div className="h-screen flex flex-col bg-gray-100">
      {/* Header with banner and profile */}
      <div className="bg-emerald-600 text-white">
        <div className="p-4">
          <div className="flex items-center gap-4">
            <div className="relative">
              <img
                src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=150&h=150&fit=crop"
                alt="Specialist profile"
                className="w-12 h-12 rounded-full object-cover"
              />
              <div className="absolute bottom-0 right-0 flex items-center">
                <Circle className="w-3 h-3 fill-green-400 text-green-400 animate-pulse" />
                <span className="text-xs ml-1">Online</span>
              </div>
            </div>
            <div>
              <h1 className="font-semibold text-lg">Especialista em Saúde Masculina</h1>
              <p className="text-sm opacity-90">Atendimento Personalizado</p>
            </div>
          </div>
        </div>
        <div className="h-20 bg-emerald-700 relative overflow-hidden">
          <img
            src="https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=1200&h=200&fit=crop"
            alt="Health banner"
            className="w-full h-full object-cover opacity-50"
          />
        </div>
      </div>

      {/* Chat messages area */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {messages.map((message) => (
          <div
            key={message.id}
            className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[80%] rounded-lg p-3 ${
                message.sender === 'user'
                  ? 'bg-emerald-500 text-white'
                  : 'bg-white text-gray-800'
              }`}
            >
              <p className="whitespace-pre-line">{message.text}</p>
              {message.options && (
                <div className="mt-4 space-y-2">
                  {message.options.map((option, index) => (
                    <button
                      key={index}
                      onClick={() => handleOptionClick(option)}
                      className="w-full p-2 text-left bg-emerald-100 hover:bg-emerald-200 text-emerald-800 rounded transition-colors"
                    >
                      {option}
                    </button>
                  ))}
                </div>
              )}
              <p className="text-xs mt-1 opacity-80">{message.timestamp}</p>
            </div>
          </div>
        ))}
        {isTyping && (
          <div className="flex justify-start">
            <div className="bg-gray-200 rounded-lg px-4 py-2">
              <div className="flex space-x-2">
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                <div className="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default App;
